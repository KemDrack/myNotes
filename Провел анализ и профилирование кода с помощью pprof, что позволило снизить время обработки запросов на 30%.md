


`pprof` – инструмент который позволяет **измерять производительность** и **анализировать узкие места** в коде

С его помощью **нашел самые медленные функции**, проанализировал **CPU и память**, а затем **исправил проблемные места**.

Cобрал **CPU-профиль** и нашел, где сервис тратит больше всего процессорного времени.
```
curl <http://localhost:6060/debug/pprof/profile?seconds=30> > cpu_profile.out
```
**Затем используйте go tool pprof для анализа:**
```go
go tool pprof -http=:8080 http://localhost:6060/debug/pprof/profile?seconds=30
go tool pprof -http=:8080 cpu_profile.out

- heap — профиль памяти (куча).
- goroutine — текущие горутины.
- profile — CPU профиль за последние 30 секунд.
```

**Проблема 1**: Медленные SQL-запросы
- Запрос к PostgreSQL загружал **все данные**, даже если клиенту нужно было только 1-2 поля.
- Не было индексов на `user_id`, из-за чего поиск выполнялся медленно.
**Проблема 2: Неэффективное использование JSON**
- Данные кэшировались в Redis **в виде JSON**, но каждый раз **перекодировались заново**, что давало лишнюю нагрузку
- Хранил JSON в `sync.Pool`, чтобы переиспользовать объекты


**Проблема 3**: Ненужные аллокации памяти
В циклах создавались **новые объекты**, что вызывало лишнюю работу сборщика мусора (GC).
**Как исправил:**  
✅ Предварительно выделял память для слайсов: