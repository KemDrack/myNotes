
|–ú–µ—Ç–æ–¥|URL|–û–ø–∏—Å–∞–Ω–∏–µ|
|---|---|---|
|`POST`|`/barriers/:id/open`|–û—Ç–∫—Ä—ã—Ç—å –±–∞—Ä—å–µ—Ä|
|`POST`|`/barriers/:id/close`|–ó–∞–∫—Ä—ã—Ç—å –±–∞—Ä—å–µ—Ä|
|`GET`|`/barriers/:id/status`|–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±–∞—Ä—å–µ—Ä–∞|
|`GET`|`/barriers/events`|–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–æ–±—ã—Ç–∏–π|

–Ø —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª **REST API**, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç:
‚úÖ **–£–¥–∞–ª–µ–Ω–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –±–∞—Ä—å–µ—Ä–∞–º–∏** ‚Äì –æ—Ç–∫—Ä—ã—Ç–∏–µ, –∑–∞–∫—Ä—ã—Ç–∏–µ, –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
‚úÖ **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ Kafka** ‚Äì –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∫–æ–º–∞–Ω–¥
‚úÖ **–•—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏ —Å–æ–±—ã—Ç–∏–π –≤ PostgreSQL** ‚Äì —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞–±–æ—Ç—ã –±–∞—Ä—å–µ—Ä–æ–≤
‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã –≤ Redis** ‚Äì –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞—Ä—å–µ—Ä–æ–≤
‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WebSockets** ‚Äì –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏


–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ, –∫–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–ª –∫–æ–º–∞–Ω–¥—É –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –±–∞—Ä—å–µ—Ä–∞?
**1Ô∏è‚É£ –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å `POST /barriers/:id/open`**  
**2Ô∏è‚É£ API –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É –≤ Kafka ‚Üí –±–∞—Ä—å–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–¥–∞—á—É**  
**3Ô∏è‚É£ –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ Redis ‚Üí –∫–ª–∏–µ–Ω—Ç—É —Å—Ä–∞–∑—É –ø—Ä–∏—Ö–æ–¥–∏—Ç –æ—Ç–≤–µ—Ç**  
**4Ô∏è‚É£ –ö–æ–≥–¥–∞ –±–∞—Ä—å–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –æ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ PostgreSQL –∏ Redis**  
**5Ô∏è‚É£ –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ WebSocket –∏–ª–∏ `GET /barriers/:id/status`**


```go
func openBarrier(c echo.Context) error {
    barrierID := c.Param("id")

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –≤ Kafka
    err := sendBarrierCommandToKafka(barrierID, "open")
    if err != nil {
        return c.JSON(http.StatusInternalServerError, echo.Map{"error": "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã"})
    }

    return c.JSON(echo.Map{
        "barrier_id": barrierID,
        "status":     "opening",
        "message":    "–ö–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞",
    })
}
```
‚úÖ **–¢–µ–ø–µ—Ä—å API –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ—ë –≤ Kafka.**


–ö–∞–∫ —Ç—ã –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–ª Kafka –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞—Ä—å–µ—Ä–∞–º–∏?
**–§—É–Ω–∫—Ü–∏—è** –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã –≤ Kafka:
```go
func sendBarrierCommandToKafka(barrierID, command string) error {
    event := map[string]interface{}{
        "barrier_id": barrierID,
        "command":    command,
        "timestamp":  time.Now().Unix(),
    }
    msg, _ := json.Marshal(event)

    return kafkaProducer.Produce(&kafka.Message{
        TopicPartition: kafka.TopicPartition{Topic: &"barrier_commands", Partition: kafka.PartitionAny},
        Value:          msg,
    }, nil)
}
```


üìå **–ö–æ–Ω—Å—é–º–µ—Ä Kafka, –∫–æ—Ç–æ—Ä—ã–π —Å–ª—É—à–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –±–∞—Ä—å–µ—Ä–∞–º–∏:**
```go
func listenBarrierCommands() {
    consumer.SubscribeTopics([]string{"barrier_commands"}, nil)
    for {
        msg, err := consumer.ReadMessage(-1)
        if err == nil {
            var command map[string]interface{}
            json.Unmarshal(msg.Value, &command)

            barrierID := command["barrier_id"].(string)
            action := command["command"].(string)

            processBarrierCommand(barrierID, action)
        }
    }
}
```
‚úÖ **–¢–µ–ø–µ—Ä—å –∫–æ–º–∞–Ω–¥—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –∞ –±–∞—Ä—å–µ—Ä—ã —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫.**



–í —Å–∏—Å—Ç–µ–º–µ –±—ã–ª–æ –¥–≤–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:  
**1Ô∏è‚É£ –û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞** (PostgreSQL) ‚Äì —Ö—Ä–∞–Ω–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –±–∞—Ä—å–µ—Ä–æ–≤  
**2Ô∏è‚É£ –ë–∞–∑–∞ –∏—Å—Ç–æ—Ä–∏–∏** (PostgreSQL, –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞) ‚Äì —Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –±–∞—Ä—å–µ—Ä–∞–º–∏

–ö–æ–≥–¥–∞ –±–∞—Ä—å–µ—Ä **–æ—Ç–∫—Ä—ã–≤–∞–ª—Å—è –∏–ª–∏ –∑–∞–∫—Ä—ã–≤–∞–ª—Å—è**, –µ–≥–æ **–∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–ª—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ**.
```sql
CREATE TABLE barriers (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    status TEXT CHECK (status IN ('opened', 'closed', 'error')),
    last_updated TIMESTAMP DEFAULT NOW()
);
```
