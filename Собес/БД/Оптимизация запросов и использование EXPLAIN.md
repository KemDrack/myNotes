EXPLAIN - команда, которая позволяет оценить сложность запроса.
v2 - это команда, которая помогает понять, как база данных собирается выполнять запрос. Она показывает, какие индексы используются, как происходит поиск, и помогает выявить узкие места в производительности.


Для того чтобы увидеть, как этот запрос будет выполняться базой данных, используем команду EXPLAIN:

```sql
EXPLAIN SELECT * FROM users WHERE email = 'example@example.com';
```

Вывод:
```sql
Seq Scan on users  (cost=0.00..25.88 rows=1 width=1000)
  Filter: (email = 'example@example.com'::text)
```

<span style="background:#fff88f">Seq Scan</span>: Это означает, что база данных выполняет последовательное сканирование всей таблицы (то есть сканирует все строки, чтобы найти подходящие записи). Это не всегда эффективно для больших таблиц, особенно если нет индекса на колонке email.

<span style="background:#fff88f">cost</span>=0.00..25.88: Оценка стоимости выполнения запроса. Первое число (0.00) — это начальная стоимость, второе (25.88) — стоимость после выполнения всего запроса.

<span style="background:#fff88f">rows</span>=1: Это оценка количества строк, которые будут возвращены запросом (в данном случае 1)

<span style="background:#fff88f">width</span>=1000: Это примерная средняя ширина одной строки в байтах.

## Оптимизация запросов

<font color="#9bbb59">Использование Индексов</font>: Создание индексов на часто используемые колонки (например, те, что используются в WHERE или JOIN) позволяет значительно ускорить выполнение запросов. Особенно полезны составные индексы, когда фильтрация идёт по нескольким колонкам.

<font color="#9bbb59">Избегание полного сканирования таблицы (Full Table Scan)</font>: Полное сканирование таблицы может быть очень медленным. Чтобы его избежать, следует использовать индексы и писать условия фильтрации так, чтобы база могла использовать существующие индексы.

<font color="#9bbb59">Выборочные столбцы:</font> Не использовать `SELECT *`, если вам нужны только конкретные столбцы. Это уменьшает количество данных, передаваемых между сервером и клиентом, и улучшает производительность.
```sql
SELECT * FROM users;

SELECT id, name, email FROM users;
```

4. **<font color="#9bbb59">Нормализация данных</font>**: Убедитесь, что данные нормализованы, чтобы избежать дублирования и избыточности, что уменьшает объём данных и повышает скорость обработки.

    > **Нормализация данных** — это процесс организации данных в базе таким образом, чтобы уменьшить избыточность (то есть устранить дублирование информации) и улучшить целостность данных. Это делается через разделение данных на отдельные таблицы и установление отношений между ними.

[[Кеширование результатов]]: Для часто повторяющихся запросов можно использовать кеширование на уровне приложения или базы данных, чтобы снизить нагрузку на сервер и ускорить ответы.

![[{FD75975F-36C3-4394-93A4-A0D8BE0ED88B}.png]]

<span style="background:#fff88f">Чтобы ускорить запрос</span> который делали выше, можно добавить индекс на поле email, что позволит базе данных избегать последовательного сканирования таблицы:
```sql
CREATE INDEX idx_users_email ON users(email);
```

Теперь при выполнении запроса с EXPLAIN, вывод будет выглядеть по-другому:
```sql
Index Scan using idx_users_email on users  (cost=0.15..8.17 rows=1 width=1000)
  Index Cond: (email = 'example@example.com'::text)
```

<span style="background:#fff88f">Index Scan</span>: Теперь используется индексное сканирование, что гораздо быстрее, чем последовательное сканирование всей таблицы.

<span style="background:#fff88f">Index Cond</span>: Это условие, использованное для поиска с помощью индекса.