**SAGA** - это паттерн, который используется для координации нескольких действий из разных сервисов, то есть когда нужно выполнить последовательность операций как одну транзакцию, но не в рамках одного сервиса, а распределенно
**SAGA** делит транзакции на маленькие шаги( По сути это **синхронное** взаимодействие между БД)

---
*Зачем он нужен?*
Когда приложение разбито на несколько сервисов, выполнение одной общей транзакции становится сложным. Например, покупка товаров в интернет-магазине может включать **оплату**, **проверку наличия** и **доставку** — каждый шаг выполняется в своём сервисе. SAGA позволяет координировать эти действия и откатывать их, если что-то пойдет не так
- Нет блокировки всех ресурсов — каждый шаг работает независимо
- Можно откатить выполненные действия, если одна из операций не удалась
- Каждый сервис делает свою часть работы и умеет её отменить при необходимости

---
***2** **подхода** к управлению SAGA*

- **[[Оркестрация]]**: По сути у нас есть один главный дирижер, а все остальные ему подчиняются
Дирижер - отдельный сервис

Один сервис (оркестратор) **управляет всей последовательностью шагов**. Он запускает действия и, если возникает ошибка, запускает откат. Каждый сервис сообщает оркестратору о завершении своего шага

*Плюсы и минусы*
- Более наглядная бизнесЛогика
- Проще делать Degug(отладку) в отличие от Хореографии и интеграционное тестирование
- Больше подходит для запутанной бизнес логики
---
- **[[Хореография]]**: Когда микросервисы друг про друга знают и они отправляют компенсирующие транзакции
Каждый сервис **самостоятельно запускает следующий шаг**и компенсацию. Например, после успешного завершения одной операции сервис посылает событие(в Кафку), которое запускает следующий сервис
*Особенности*
- Для сложной бизнес логики **Хореография не очень подходит из за того**, что трудно будет осознать всю картину мира, где и что происходит + сложно будет делать Debug и интеграционное тестрирование
- Хорошо подходит для **не супер больших систем**
- Нет единой **точки отказа** (бизнес логика распределена по всем микрам и нет 1 сервиса, который в ней является главным)
- Трудно разработать логику для отмены (компенсирующих действий)
- Сложно отслеживать транзакции, если бизнес логика сложная и запутанная
*Сравнение*
- Проще в реализации
- Не требует реализации отдельного модуля как в оркестрации
- Нет единой точки отказа
---

**Паттерн SAGA** — это простой способ координировать действия в распределённых системах, чтобы поддерживать **согласованность данных**. Он помогает разбить большую транзакцию на отдельные шаги и откатывать их, если что-то пошло не так. Главное — продумать, как откатить изменения в случае ошибки, чтобы не оставлять данные в некорректном состоянии.

Если один из шагов завершается с ошибкой (например, товара нет в наличии), нужно откатить предыдущие шаги, чтобы сохранить **согласованность** **данных**.





