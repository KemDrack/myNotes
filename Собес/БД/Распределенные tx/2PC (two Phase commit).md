–ü–µ—Ä–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–≤—É—Ö—Ñ–∞–∑–Ω–æ–≥–æ –∫–æ–º–º–∏—Ç–∞: –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–≤—É—Ö—Ñ–∞–∑–Ω—ã–π –∫–æ–º–º–∏—Ç


–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å(**–∏–∑–æ–ª—è—Ü–∏—è**) ‚Üí 2PC. –ï—Å–ª–∏ –≤–∞–∂–Ω–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å ‚Üí [[SAGA]]

–≠—Ç–æ **–ø—Ä–æ—Ç–æ–∫–æ–ª —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**, –∫–æ—Ç–æ—Ä—ã–π –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç **–∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å** (–ª–∏–±–æ –≤—Å–µ —É–∑–ª—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç –æ–ø–µ—Ä–∞—Ü–∏—é, –ª–∏–±–æ –Ω–∏–∫—Ç–æ)

üìå **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤—Å–µ–º —É–∑–ª–∞–º (**`prepare`**) —Å –ø—Ä–æ—Å—å–±–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –∫–æ–º–º–∏—Ç—É.
–ö–∞–∂–¥—ã–π —É–∑–µ–ª (—É—á–∞—Å—Ç–Ω–∏–∫):
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –æ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.
- –ï—Å–ª–∏ **–≥–æ—Ç–æ–≤** ‚Äî –æ—Ç–≤–µ—á–∞–µ—Ç **`YES`**.
- –ï—Å–ª–∏ **–Ω–µ –º–æ–∂–µ—Ç** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—à–∏–±–∫–∞ –∏–ª–∏ –Ω–µ—Ç —Ä–µ—Å—É—Ä—Å–æ–≤) ‚Äî –æ—Ç–≤–µ—á–∞–µ—Ç **`NO`**.

Commit (—Ñ–∞–∑–∞ —Ñ–∏–∫—Å–∞—Ü–∏–∏)
- –ï—Å–ª–∏ **–≤—Å–µ** —É—á–∞—Å—Ç–Ω–∏–∫–∏ –æ—Ç–≤–µ—Ç–∏–ª–∏ **`–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï–ú`**, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **`commit`**.
- –ï—Å–ª–∏ **—Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω** –æ—Ç–≤–µ—Ç–∏–ª **`NO`**, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **`rollback`**.

(Commit/Rollback)
**–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä** –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –¥–≤—É—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö:  
‚úÖ **DB1 (—Å–ø–∏—Å–∞–Ω–∏–µ –¥–µ–Ω–µ–≥)**: "–ú–æ–∂–µ—à—å –ª–∏ —Ç—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å 100$?"  
‚úÖ **DB2 (–∑–∞—á–∏—Å–ª–µ–Ω–∏–µ –¥–µ–Ω–µ–≥)**: "–ú–æ–∂–µ—à—å –ª–∏ —Ç—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –∑–∞—á–∏—Å–ª–µ–Ω–∏—é?"
- –¢–∞–∫ –∫–∞–∫ **–æ–±–∞ —É–∑–ª–∞ –≥–æ—Ç–æ–≤—ã**, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **`commit`**.
- **DB1 —Å–ø–∏—Å—ã–≤–∞–µ—Ç 100$**.
- **DB2 –∑–∞—á–∏—Å–ª—è–µ—Ç 100$**.


–ú–∏–Ω—É—Å—ã:
- –ü–æ–∫–∞ –∏–¥—ë—Ç `prepare`, —Ä–µ—Å—É—Ä—Å—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã, –∏ –¥—Ä—É–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∂–¥—É—Ç
- –ï—Å–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä —É–º–∏—Ä–∞–µ—Ç –ø–µ—Ä–µ–¥ `commit`, —É—á–∞—Å—Ç–Ω–∏–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.
- –ú–µ–¥–ª–µ–Ω–Ω–æ (–∏–∑-–∑–∞ —Å–µ—Ç–µ–≤—ã—Ö –≤—ã–∑–æ–≤–æ–≤)

–í **–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö** —á–∞—Å—Ç–æ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ Saga Pattern, —Ç.–∫. 2PC —Ç—è–∂—ë–ª –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.

![[{A5968CE0-9D0B-465E-B133-73A1611AFCCE}.png]]




3PC
