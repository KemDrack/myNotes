
Defer –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π. –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ defer –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ —Ç–µ–∫—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è

> [!NOTE]
> > **Defer** —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω–∞ –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ defer –±—ã–ª –æ–±—ä—è–≤–ª–µ–Ω

–ö–æ–≥–¥–∞ –º—ã –≤—ã–∑—ã–≤–∞–µ–º defer, –æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤([[–°—Ç–µ–∫ –∏ –ö—É—á–∞]]). –°—Ç–µ–∫ ‚Äî —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, —Ä–∞–±–æ—Ç–∞—é—â–∞—è –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É LIFO (–ø–æ—Å–ª–µ–¥–Ω–∏–º –ø—Ä–∏—à—ë–ª ‚Äî –ø–µ—Ä–≤—ã–º –≤—ã—à–µ–ª)

```go
func example() {
    defer fmt.Println("–ü–µ—Ä–≤—ã–π")
    defer fmt.Println("–í—Ç–æ—Ä–æ–π")
    fmt.Println("–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥")
}
–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ 
–í—Ç–æ—Ä–æ–π 
–ü–µ—Ä–≤—ã–π
```
–§—É–Ω–∫—Ü–∏–∏, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≤ —Å—Ç–µ–∫ —á–µ—Ä–µ–∑ defer, –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ, –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ–º –∏—Ö –¥–æ–±–∞–≤–ª–µ–Ω–∏—é. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –æ—á–∏—Å—Ç–∫–∏, —Ç–∞–∫–∏—Ö –∫–∞–∫ –∑–∞–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

defer –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω, –∫–æ–≥–¥–∞ **–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** –∫–∞–∫–æ–≥–æ-—Ç–æ –∫–æ–¥–∞, **–Ω–∞–ø—Ä–∏–º–µ—Ä**, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è ‚Äî —É—Å–ø–µ—à–Ω–æ –∏–ª–∏ —Å –æ—à–∏–±–∫–æ–π

--------------------------------------------------------------------
Defer —Ç–∞–∫–∂–µ —à–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π **–≥–æ—Ä—É—Ç–∏–Ω** –∏ **–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏**

1. defer **wg.Done**()
–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å sync.[[WaitGroup]], —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–µ—Ç–æ–¥ **Done**() –≤—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π:
```go
var wg sync.WaitGroup

func worker() {
    defer wg.Done() // ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–∞–µ–º —Å—á–µ—Ç—á–∏–∫, –∫–æ–≥–¥–∞ –≥–æ—Ä—É—Ç–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è
    // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–¥–∞—á—É
    fmt.Println("üèÅ –†–∞–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
}

func main() {
    wg.Add(1)
    go worker()
    wg.Wait() // –û–∂–∏–¥–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≥–æ—Ä—É—Ç–∏–Ω
}
```
–ó–¥–µ—Å—å defer wg.**Done**() –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ **Done**() –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –≤ –∫–æ–Ω—Ü–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ **worker**, —á—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–º–µ–Ω—å—à–∏—Ç —Å—á—ë—Ç—á–∏–∫ **WaitGroup**

2. defer mutex.**Unlock**()
–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ **–º—å—é—Ç–µ–∫—Å–æ–≤** (sync.[[Mutex]]) –≤–∞–∂–Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (Unlock) –±—É–¥–µ—Ç —Å–Ω—è—Ç–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –æ—à–∏–±–∫–∞:
```go
var mu sync.Mutex

func criticalSection() {
    mu.Lock()
    defer mu.Unlock() // üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –º—å—é—Ç–µ–∫—Å –≤ –∫–æ–Ω—Ü–µ —Ñ—É–Ω–∫—Ü–∏–∏
    // ‚öôÔ∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–∫—Ü–∏—è –∫–æ–¥–∞
    fmt.Println("üîí –í—ã–ø–æ–ª–Ω—è–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é —Å–µ–∫—Ü–∏—é")
}

func main() {
    criticalSection()
}
```
–ó–¥–µ—Å—å defer mu.**Unlock**() –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –º—å—é—Ç–µ–∫—Å –±—É–¥–µ—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –¥–∞–∂–µ –µ—Å–ª–∏ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–µ–∫—Ü–∏–∏ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –æ—à–∏–±–∫–∞, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–µ–¥–ª–æ–∫–∞.

3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ defer —Å **–¢–∞–π–º–µ—Ä–∞–º–∏**
**defer** —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–æ–≤ –∏–ª–∏ –æ—á–∏—Å—Ç–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:
```go
func doWithTimeout() {
    ctx, cancel := context.WithTimeout(context.Background(), 2*time.Second)
    defer cancel() // ‚è±Ô∏è –û—Ç–º–µ–Ω—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é —Ñ—É–Ω–∫—Ü–∏–∏
    // –í—ã–ø–æ–ª–Ω—è–µ–º –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —É—á–µ—Ç–æ–º —Ç–∞–π–º–∞—É—Ç–∞
    select {
    case &lt;-ctx.Done():
        fmt.Println("‚è∞ –¢–∞–π–º–∞—É—Ç –∏—Å—Ç–µ–∫")
    }
}
```
–ó–¥–µ—Å—å defer **cancel**() –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–º–µ–Ω—ë–Ω –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏, –æ—Å–≤–æ–±–æ–∂–¥–∞—è —Ä–µ—Å—É—Ä—Å—ã.


<u>–í–æ–ø—Ä–æ—Å—ã</u>:
### **–ö–∞–∫ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–∞–Ω–∏–∫—É?**

–ß–µ—Ä–µ–∑ defer recovery()

- `recover()` ‚Äî —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–Ω–∏–∫—É –∏ –≤–µ—Ä–Ω—É—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–µ
- –û–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ **–æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π** (`defer`)
- –ï—Å–ª–∏ `recover()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤–Ω–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–∞–Ω–∏–∫–∏, –æ–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç`nil`
```go
package main

import "fmt"

func main() {
    fmt.Println("–ù–∞—á–∞–ª–æ –ø—Ä–æ–≥—Ä–∞–º–º—ã")

    // –ü–µ—Ä–µ—Ö–≤–∞—Ç –ø–∞–Ω–∏–∫–∏ —á–µ—Ä–µ–∑ defer
    defer func() {
        if r := recover(); r != nil {
            fmt.Println("–ü–∞–Ω–∏–∫–∞ –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–∞:", r)
        }
    }()

    // –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç –ø–∞–Ω–∏–∫—É
    causePanic()

    fmt.Println("–ö–æ–Ω–µ—Ü –ø—Ä–æ–≥—Ä–∞–º–º—ã") // –≠—Ç–æ—Ç –∫–æ–¥ –Ω–µ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω, –µ—Å–ª–∏ panic –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–∞
}

func causePanic() {
    fmt.Println("–°–µ–π—á–∞—Å –±—É–¥–µ—Ç –ø–∞–Ω–∏–∫–∞!")
    panic("–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫") // –ò–Ω–∏—Ü–∏–∏—Ä—É–µ–º –ø–∞–Ω–∏–∫—É
}
–ù–∞—á–∞–ª–æ –ø—Ä–æ–≥—Ä–∞–º–º—ã 
–°–µ–π—á–∞—Å –±—É–¥–µ—Ç –ø–∞–Ω–∏–∫–∞! 
–ü–∞–Ω–∏–∫–∞ –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–∞: –ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
```

