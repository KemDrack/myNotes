
**Context** — это инструмент для управления временем выполнения операций (сроками жизни между процессами, горутинами или запросами), передачи данных между горутинами, а также для сигналов об отмене операций

Пакет `context` предоставляет несколько видов контекстов, каждый из которых предназначен для конкретных задач

> [!NOTE]
> Любой context должен наследоваться от другого родительского контекста. Исключения: **Background** и **TODO**(заглушка)

![[{21A9882F-9160-482B-A223-AAF19B4D5498} 1.png]]

**Background**: Это базовый контекст, обычно используется в качестве корневого контекста. Он не отменяется и не имеет тайм-аута. Чаще всего применяется для инициализации верхнего уровня, например, при запуске приложения

**TODO**: Используется, когда не ясно, какой контекст использовать или когда контекст будет определён позже. Это своего рода заглушка для будущих изменений. Работает аналогично `context.Background`

**WithCancel**: Этот тип контекста создаёт дочерний контекст с возможностью отмены. Он часто используется для управления завершением горутин. Когда вызывается cancel(), все горутины, использующие этот контекст, должны завершиться
```go
func main() {
    ctx, cancel := context.WithCancel(context.Background())
    defer cancel()

    go func(ctx context.Context) {
        for {
            select {
            case <-ctx.Done():
                fmt.Println("Горутина завершена")
                return
            default:
                fmt.Println("Работа горутины...")
                time.Sleep(1 * time.Second)
            }
        }
    }(ctx)

    time.Sleep(3 * time.Second)
    cancel() // Завершаем горутину через 3 секунды
    time.Sleep(1 * time.Second)
}
```

**WithDeadline**: Создаёт контекст с временной границей, после которой он отменяется

**WithTimeout**: Это обертка над **WithDeadline**. **WithTimeout** внутри себя вызывает **WithDeadline**, где в качестве **Deadline** она использует текущее время, к которому прибавленно значение **Timeout**. Позволяет указать таймаут вместо конкретного времени

![[{D84AEDC6-B8D0-4D5A-90A1-B58248318E3E}.png]]

**Пример**: Наше приложение отправляет запрос во внешнюю систему([[API]] другого сервиса), который владеет интересующими нас данными. Мы не можем быть уверены, что API ответит за приемлемое время или вообще ответит когда либо. Чтобы не зависнуть навечно в ожидании ответа API, в запрос можно передать **context**

```sql
ctx, cancel := context.WithTimeout(context.Background(), 2*time.Second)
defer cancel()

select {
case <-time.After(3 * time.Second):
    fmt.Println("Operation completed")
case <-ctx.Done():
    fmt.Println("Timeout exceeded:", ctx.Err())
}
```

