

[[Ответ на вопрос(что делал)]]

**Envoy** - прокси-сервер с открытым исходным кодом, оптимизированный для микросервисных архитектур. Он разработан для решения задач, связанных с маршрутизацией, **балансировкой нагрузки**, безопасностью и наблюдаемостью в распределённых системах.

**Ключевые возможности Envoy Proxy:**

**Балансировка нагрузки:** ([[load balancer]])
- Использование алгоритмов, таких как round-robin, least-request, random и др.
**Разделение и маршрутизация трафика:**
- Если у вас есть несколько версий микросервиса (например, A/B-тестирование), Envoy может маршрутизировать запросы по определённым правилам (например, 50% трафика отправлять в сервис версии 1, 50% — в версию 2).
**Поддержка динамической конфигурации (xDS API):**
- Настройки можно менять в реальном времени, не перезапуская прокси
**Envoy автоматически собирает метрики и трассировку запросов**


### **Алгоритмы балансировки нагрузки**
 1. <u>Round Robin (по умолчанию в Envoy)</u>
Циклически распределяет запросы между всеми доступными серваками
Первый запрос отправляется на первый сервер -> Второй запрос на второй сервер и так далее.
**Преимущества:**
- Простота реализации
- Подходит для равномерной нагрузки, если все серверы имеют одинаковую производительность
**Недостатки:**
- Не учитывает текущую загрузку серверов
- Может быть неэффективен, если серверы имеют разную мощность

2. <u>Least Request</u>
Запрос направляется на сервер с наименьшим количеством активных соединений.
**Как работает:**
1. Система отслеживает активные соединения на каждом сервере.
2. Новый запрос отправляется на сервер, у которого минимальное количество текущих соединений.
 **Преимущества:**
    - Учитывает текущую загрузку серверов.
    - Подходит для систем с нерегулярной нагрузкой на серверы.
 **Недостатки:**
    - Требует мониторинга активных соединений.
    - При очень быстром росте трафика может возникнуть задержка в перераспределении.
3. <u>Random</u>
Запросы отправляются случайным образом на любой доступный сервер**Преимущества:**
    - Простота реализации.
    - Хорошо распределяет нагрузку в больших кластерах, где важно уменьшить конфликт между узлами.
**Недостатки:**
    - Непредсказуемость может привести к временной перегрузке одного сервера.
4. <u>Weighted Round Robin</u>
Вариант Round Robin, где серверам назначаются веса. Сервер с большим весом получает больше запросов.
- **Как работает:**
    1. Сервер с весом 5 обрабатывает больше запросов, чем сервер с весом 1.
    2. Запросы распределяются пропорционально весам.
- **Преимущества:**
    - Подходит для кластеров с серверами разной производительности.
5. Ring Hash
Использует хэширование для маршрутизации запросов на конкретный сервер. Это обеспечивает консистентное хэширование
- Создаётся "кольцо" хэшей для серверов.
- Запросы направляются на сервер в зависимости от хэша ключа (например, ID пользователя)


LeastRequest:
```yml
static_resources:
  clusters:
    - name: go_service_cluster
      connect_timeout: 0.25s
      type: LOGICAL_DNS
      lb_policy: LEAST_REQUEST
      load_assignment:
        cluster_name: go_service_cluster
        endpoints:
          - lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: service1
                      port_value: 8080
              - endpoint:
                  address:
                    socket_address:
                      address: service2
                      port_value: 8080
              - endpoint:
                  address:
                    socket_address:
                      address: service3
                      port_value: 8080
```