


В Go сборщик мусора (GC) — отвечает за автоматическое управление памятью. Основная задача GC — освобождать память, занимаемую объектами, которые больше не используются, чтобы избежать утечек памяти и снизить риск ошибок, связанных с ручным управлением памятью.

Принцип работы сборщика мусора в Go — **конкурентный, трехфазный, трассирующий сборщик** с использованием **маркировки и зачистки** (mark-and-sweep)(Отметить "Живые" объекты, Очистить не помеченные объекты на фазе mark). Он разработан так, чтобы минимизировать паузы выполнения и не останавливать работу программы (конкурентный GC).

**Конкурентный** (Concurrent): Сборщик мусора в Go работает параллельно с приложением. Это позволяет избегать длительных пауз, которые бывают у других типов сборщиков, таких как "Stop-the-world". Во время маркировки и зачистки GC может продолжать работать параллельно с горутинами.

**Трехфазный процесс**:
    - **STW (Stop-the-world) Начальная маркировка**: Процесс начинается с короткой паузы, в течение которой определяются корневые объекты. Это так называемая "STW" фаза, но её длительность минимальна.
    - **Конкурентная маркировка**: На этом этапе GC проходит по всем объектам и отмечает те, которые всё ещё используются.
    - **STW Завершающая маркировка и зачистка**: После завершения маркировки начинается фаза зачистки, в ходе которой память, занятая неиспользуемыми объектами, освобождается.

## Важные характеристики и оптимизация

- **GOGC** — это переменная окружения, которая контролирует частоту запуска GC. По умолчанию значение **GOGC** — `100`, что означает, что GC запустится, когда объём используемой памяти увеличится на 100% с момента последнего сбора. Значение можно изменить для управления производительностью: меньшее значение — более частые сборки, но и большее потребление ресурсов процессора.
- **Write Barrier**: В Go используется "Write Barrier" для поддержки конкурентного GC. Это значит, что при изменении ссылок на объекты выполняются дополнительные операции для отслеживания изменений в памяти, что помогает безопасно выполнять маркировку.
- **STW паузы**: В новых версиях Go удалось значительно уменьшить паузы STW благодаря улучшению алгоритмов. Например, начиная с версии Go 1.8, паузы обычно не превышают **50 микросекунд**, что делает работу сборщика почти незаметной.

## Плюсы и минусы GC в Go

- **Плюсы**:
    - Автоматическое управление памятью, что снижает вероятность ошибок.
    - Конкурентная работа, минимизация пауз, что делает его подходящим для высокопроизводительных приложений.
- **Минусы**:
    - Накладные расходы на выполнение write barriers.
    - Может потребоваться ручная оптимизация, особенно при работе с большими данными или высокочастотными задачами.